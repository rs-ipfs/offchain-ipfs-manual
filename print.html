<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The offchain::ipfs Manual</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="using-the-docker-image.html"><strong aria-hidden="true">2.1.</strong> Using the Docker image</a></li><li class="chapter-item expanded "><a href="previewing-functionality.html"><strong aria-hidden="true">2.2.</strong> Previewing the functionality with a nice UI</a></li><li class="chapter-item expanded "><a href="offchain-ipfs-callables.html"><strong aria-hidden="true">2.3.</strong> offchain::ipfs callables</a></li></ol></li><li class="chapter-item expanded "><a href="building-an-offchain-ipfs-app.html"><strong aria-hidden="true">3.</strong> Building an offchain::ipfs app</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="how-it-works.html"><strong aria-hidden="true">3.1.</strong> How it works</a></li><li class="chapter-item expanded "><a href="offchain-ipfs-rust.html"><strong aria-hidden="true">3.2.</strong> In Rust</a></li><li class="chapter-item expanded "><a href="offchain-ipfs-javascript.html"><strong aria-hidden="true">3.3.</strong> In JavaScript</a></li></ol></li><li class="chapter-item expanded "><a href="contributing-development.html"><strong aria-hidden="true">4.</strong> Contributing / Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="building-offchain-ipfs-source.html"><strong aria-hidden="true">4.1.</strong> Building from Source</a></li><li class="chapter-item expanded "><a href="offchain-ipfs-architecture.html"><strong aria-hidden="true">4.2.</strong> Architectural Explanation</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The offchain::ipfs Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p><a href="https://substrate.io">Substrate</a> is a blockchain and smart contract framework written in the Rust programming language.
The InterPlanetary File System (or <a href="https://ipfs.io">IPFS</a>) is a distributed, peer-to-peer,
content-addressed storage framework.</p>
<p>Substrate has many features that differentiate it from a typical blockchain framework. One
such feature is <a href="https://www.substrate.io/kb/learn-substrate/off-chain-workers">Off-Chain Workers</a>, which are separate wasm execution contexts that run alongside
your blockchain nodeâ€™s runtime, enabling you to make send and receive data from external sources,
such as HTTP APIs.</p>
<p>Thinking about an Off-Chain Worker in the context of IPFS led us to develop this functionality,
called <code>offchain::ipfs</code>. This gives you a reduced, but still powerful, subset of IPFS commands
you can call right from your pallet, on block creation, to achieve things like:</p>
<ul>
<li>Bytes -&gt; Content ID (CID) data storage</li>
<li>CID -&gt; Bytes data storage</li>
<li>Peer and content discovery via the distributed hash table (DHT)</li>
<li>Libp2p connection and swarming with other IPFS peers</li>
<li>Pinning and unpinning CIDs</li>
</ul>
<p>This material and Rust IPFS itself are presented by the rs-ipfs team:
<a href="https://github.com/koivunej">@koivunej</a>, <a href="https://github.com/ljedrz">@ljedrz</a>, <a href="https://github.com/whalelephant">@whalelephant</a>, and <a href="https://github.com/aphelionz">@aphelionz</a></p>
<p>TODO: Video embed in book</p>
<h2><a class="header" href="#a-quick-note-about-node-template" id="a-quick-note-about-node-template">A quick note about <code>node-template</code></a></h2>
<p>The primary value of this work is the embedded IPFS node itself and its Off-chain Worker APIs.</p>
<p>We reference the <code>node-template</code> pallet and executable throughout this manual. This included pallet
is meant to be a showcase of the embedded IPFS node, and is just one of many possible integrations
and uses cases that are possible. More IPFS functionalities could be exposed, and the ones exposed
could be improved and personalized further.</p>
<p>Finally, while we are moving towards documenting and releasing this work in a more official
capacity, <code>offchain::ipfs</code> should still be considered an alpha preview.</p>
<h1><a class="header" href="#getting-started" id="getting-started">Getting Started</a></h1>
<p>Our <a href="https://github.com/rs-ipfs/substrate">code base</a> is currently a well-maintained fork of <a href="https://github.com/paritytech/substrate">paritytech/substrate</a> and will remain so
until we are confident enough to make a PR proposing its inclusion to Substrateâ€™s core.</p>
<p>In the meantime, and for simplicityâ€™s sake, we are using a Docker image for delivery. Additionally,
we will cover how to use the baseline <a href="https://github.com/substrate-developer-hub/substrate-front-end-template">substrate-front-end-template</a> to quickly preview
the functionality.</p>
<p>TODO: Anything else here?</p>
<h2><a class="header" href="#using-the-docker-image" id="using-the-docker-image">Using the Docker image</a></h2>
<p>Currently, the recommended way to use <code>offchain::ipfs</code> is via the Docker image provided by
<a href="https://equilibrium.co">Equilibrium</a>.</p>
<p>Simply pull the [eqlabs/substrate-ipfs] image from Docker Hub:</p>
<pre><code class="language-bash">$ docker pull eqlabs/substrate-ipfs
</code></pre>
<p>The image comes with two binaries:</p>
<ol>
<li><code>node-template</code> - which serves as a preview pallet and reference implementation</li>
<li><code>substrate-ipfs</code> - which is the real deal. Substrate infused with IPFS</li>
</ol>
<h2><a class="header" href="#running-node-template" id="running-node-template">Running <code>node-template</code></a></h2>
<p>By default, the container will execute a command for starting the node-template binary with a
development chainspec. We expose the default websockets, rpc, p2p and prometheus ports from the
container to the host machine for interactions.</p>
<pre><code class="language-bash">$ docker run \
    -p 9944:9944 \            # websockets
    -p 9933:9933 \            # rpc
    -p 30333:30333 \          # p2p
    -p 9615:9615 \            # prometheus
    -it \
    --rm \
    --name node-template \
    substrate-ipfs
</code></pre>
<h2><a class="header" href="#running-substrate-ipfs" id="running-substrate-ipfs">Running <code>substrate-ipfs</code></a></h2>
<pre><code class="language-bash">$ docker run \
    -p 9944:9944 \            # websockets
    -p 9933:9933 \            # rpc
    -p 30333:30333 \          # p2p
    -p 9615:9615 \            # prometheus
    -it \
    --rm \
    --name sub-ipfs \
    substrate-ipfs \
    substrate                 # Override default command
</code></pre>
<h2><a class="header" href="#container-customizations" id="container-customizations">Container customizations</a></h2>
<p>Several options are already available to tailor your container's runtime to suit your needs.</p>
<h3><a class="header" href="#persistent-storage" id="persistent-storage">Persistent Storage</a></h3>
<p>To run with persistent storage volume between containers, first create a volume:</p>
<pre><code class="language-bash">$ docker volume create substrate-ipfs-vol
</code></pre>
<p>Then add <code>-v substrate-ipfs-vol:/substrate-ipfs</code> to the docker run commands above.</p>
<h3><a class="header" href="#running-a-custom-command" id="running-a-custom-command">Running a custom command</a></h3>
<p>To overwrite the default container commands, simply add the binary name followed by
flags, options, or subcommands to the end of the <code>docker run</code> command.</p>
<h3><a class="header" href="#complete-customization-example" id="complete-customization-example">Complete customization example</a></h3>
<p>Putting it all together, a complete command with a persistent volume and a custom
executable command might look something like this:</p>
<p>For example, to display the help information from <code>substrate</code></p>
<pre><code class="language-bash">$ docker run \
    -p 9944:9944 \
    -p 9933:9933 \
    -p 30333:30333 \
    -p 9615:9615 \
    -it \
    --rm \
    --name sub-ipfs \
    -v substrate-ipfs-vol:/substrate-ipfs \       # mounted docker volume
    substrate-ipfs \
    substrate --help                              # override custom command
</code></pre>
<h1><a class="header" href="#previewing-the-functionality-with-a-nice-ui" id="previewing-the-functionality-with-a-nice-ui">Previewing the functionality with a nice UI</a></h1>
<p>If youâ€™re looking for a quick demo of the functionality, the simplest thing to do is to launch
the [substrate-frontend-template] UI.</p>
<p>First run the docker image via the instructions in the previous section, and then run the 
following steps:</p>
<pre><code class="language-bash">$ git clone https://github.com/substrate-developer-hub/substrate-front-end-template
$ cd substrate-front-end-template
$ yarn install
$ yarn start
</code></pre>
<p>This will automatically launch a browser with a UI allowing you to interact with your node's
capabilities.</p>
<h2><a class="header" href="#using-offchainipfs-via-the-ui" id="using-offchainipfs-via-the-ui">Using <code>offchain::ipfs</code> via the UI</a></h2>
<p>Once the browser page opens, scroll to the bottom to the <strong>Pallet Interactor</strong> section.
Make sure the &quot;Extrinsic&quot; radio button is active, and then select <code>templateModule</code> from the
&quot;Pallets / RPC&quot; dropdown.</p>
<p><img src="./img/pallet-interactor-1.png" alt="Pallet Interactor Screenshot 1" /></p>
<p>Then, select the callable you want from the list of callables that become available:</p>
<p><img src="./img/pallet-interactor-2.png" alt="Pallet Interactor Screenshot 2" /></p>
<p>Once a callable is selected, an additional text field or fields will appear below the Callables
select box. Type the arguments in and then click <em>Signed</em>. Watch your node logs and also the
extrinsic events to the right for output and information.</p>
<p><img src="./img/pallet-interactor-3.png" alt="Pallet Interactor Screenshot 3" /></p>
<p>Read on for a detailed list of callables that <code>offchain::ipfs</code> exposes.</p>
<h1><a class="header" href="#offchainipfs-callables" id="offchainipfs-callables">offchain::ipfs callables</a></h1>
<p>The following callables are available to you. These were chosen due to popularity and to try
and give substrate uses the most cohesive and familiar experience using IPFS within their node.</p>
<ul>
<li>api.tx.templateModule.ipfsAddBytes - add the given bytes to the IPFS repository; the off-chain worker interval for this activity is every block with an odd BlockNumber (i.e. every other block). For example adding 1234 gives you the CID QmU1f6ngsoHvwtViihzLQPXCA8j3sagmvY9GJJDY7Ao7Aa</li>
<li>api.tx.templateModule.ipfsCatBytes - display the bytes (UTF-8 is displayed as a string, while non-UTF-8 bytes are displayed in their hexadecimal representation) with the given Cid; the off-chain worker interval for this activity is also every block with an odd BlockNumber. In the inverse of the last item, requesting the CID above will return 1234</li>
<li>api.tx.templateModule.ipfsConnect - connect to the given Multiaddr; the off-chain worker interval for this activity is every block (the queue of connection requests is processed with every block in the chain). Try it with /ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ.</li>
<li>api.tx.templateModule.ipfsDisconnect - disconnect from the given Multiaddr; the off-chain worker interval for this activity is also every block. You can try disconnecting from multiaddr from the previous item.</li>
<li>api.tx.templateModule.ipfsDhtFindPeer - perform a search for the addresses associated with the provided PeerId; the off-chain worker interval for this activity is every block. If you use the peerID from two items prior, QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ, it will return /ip4/104.131.131.82/tcp/4001.</li>
<li>api.tx.templateModule.ipfsDhtFindProviders - search for PeerIds known to be providing the given Cid; the off-chain worker interval for this activity is every block. Try it with the hash of the IPFS CID Inspector, QmY7Yh4UquoXHLPFo2XbhXkhBvFoPwmQUSa92pxnxjQuPU. Make sure youâ€™re connected to at least one peer though!</li>
<li>api.tx.templateModule.ipfsInsertPin - pin a block with the specified Cid, making it persistent; a pinned block canâ€™t be removed. Try pinning the 1234 CID above: QmU1f6ngsoHvwtViihzLQPXCA8j3sagmvY9GJJDY7Ao7Aa</li>
<li>api.tx.templateModule.ipfsRemovePin - remove a pin from a block, i.e. unpin it, so that it is no longer persistent and can be removed too. Trey removing the pin from the previous item.</li>
<li>api.tx.templateModule.ipfsRemoveBlock - remove a block from the nodeâ€™s repository</li>
</ul>
<h1><a class="header" href="#building-an-offchainipfs-app" id="building-an-offchainipfs-app">Building an offchain::ipfs app</a></h1>
<p>In this book weâ€™ll cover the bare essentials on what you need to start building out your dApp
with offchain::ipfs. We cover two Rust clients and one JavaScript client, but there are
many other clients in other languages.</p>
<h1><a class="header" href="#how-it-works" id="how-it-works">How it works</a></h1>
<p>TODO</p>
<h1><a class="header" href="#using-offchainipfs-from-your-rust-code" id="using-offchainipfs-from-your-rust-code">Using <code>offchain::ipfs</code> from your Rust code</a></h1>
<h2><a class="header" href="#with-substrate-subxt" id="with-substrate-subxt">With <code>substrate-subxt</code></a></h2>
<p>In your Cargo.toml file</p>
<pre><code class="language-toml">[dependencies]
substrate-subxt = &quot;0.13.0&quot;
async-std = { version = &quot;1.6.4&quot;, features = [&quot;attributes&quot;] }
codec = { package = &quot;parity-scale-codec&quot;, version = &quot;1.3.5&quot;, default-features = false, features = [&quot;derive&quot;] }
substrate-subxt = &quot;0.13.0&quot;
sp-keyring = { version = &quot;2.0.0&quot;, default-features = false }
</code></pre>
<p>Then in your main.rs:</p>
<pre><pre class="playground"><code class="language-rust">use codec::Encode;
use sp_keyring::AccountKeyring;
use substrate_subxt::{Call, ClientBuilder, EventsDecoder, NodeTemplateRuntime, PairSigner};

#[async_std::main]
async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    // Signer for the extrinsic
    let signer = PairSigner::&lt;NodeTemplateRuntime, _&gt;::new(AccountKeyring::Alice.pair());
    // API client, default to connect to 127.0.0.1:9944
    let client = ClientBuilder::&lt;NodeTemplateRuntime&gt;::new().build().await?;

    // Example CID for the example bytes added vec![1, 2, 3, 4]
    let cid = String::from(&quot;QmRgctVSR8hvGRDLv7c5H7BCji7m1VXRfEE1vW78CFagD7&quot;)
        .into_bytes()
        .to_vec();
    // Example multiaddr to connect IPFS with
    let multiaddr = String::from(
        &quot;/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ&quot;,
    )
    .into_bytes()
    .to_vec();
    // Example Peer Id
    let peer_id = String::from(&quot;QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ&quot;)
        .into_bytes()
        .to_vec();

    // Begin to submit extrinsics
    // ipfs_add_bytes
    let add_bytes = client
        .watch(
            AddBytesCall {
                data: vec![1, 2, 3, 4],
            },
            &amp;signer,
        )
        .await?;
    println!(&quot;\nResult for ipfs_add_bytes: {:?}&quot;, add_bytes);

    Ok(())
}

#[derive(Encode)]
pub struct AddBytesCall {
    data: Vec&lt;u8&gt;,
}

impl Call&lt;NodeTemplateRuntime&gt; for AddBytesCall {
    const MODULE: &amp;'static str = &quot;TemplateModule&quot;;
    const FUNCTION: &amp;'static str = &quot;ipfs_add_bytes&quot;;
    fn events_decoder(_decoder: &amp;mut EventsDecoder&lt;NodeTemplateRuntime&gt;) {}
}

</code></pre></pre>
<h3><a class="header" href="#with-substrate-api-client" id="with-substrate-api-client">With <code>substrate-api-client</code></a></h3>
<p>In your Cargo.toml file:</p>
<pre><code class="language-toml">[dependencies]
substrate-api-client = { git = &quot;https://github.com/scs/substrate-api-client.git&quot; }
sp-core = { version = &quot;2.0.0&quot;, features = [&quot;full_crypto&quot;] }
sp-keyring = { version = &quot;2.0.0&quot;, default-features = false } 
</code></pre>
<p>Then in your main.rs:</p>
<pre><pre class="playground"><code class="language-rust">use sp_core::crypto::Pair;
use sp_keyring::AccountKeyring;
use std::{convert::TryFrom, string::String};
use substrate_api_client::{
    compose_call, compose_extrinsic_offline, extrinsic::xt_primitives::UncheckedExtrinsicV4,
    node_metadata::Metadata, Api, XtStatus,
};

fn main() {
    // instantiate an Api that connects to the given address
    let url = &quot;127.0.0.1:9944&quot;;
    // if no signer is set in the whole program, we need to give to Api a specific type instead of an associated type
    // as during compilation the type needs to be defined.
    let signer = AccountKeyring::Bob.pair();

    // sets up api client and retrieves the node metadata
    let api = Api::new(format!(&quot;ws://{}&quot;, url)).set_signer(signer.clone());
    // gets the current nonce of Bob so we can increment it manually later
    let mut nonce = api.get_nonce().unwrap();

    // data from the node required in extrinsic
    let meta = Metadata::try_from(api.get_metadata()).unwrap();
    let genesis_hash = api.genesis_hash;
    let spec_version = api.runtime_version.spec_version;
    let transaction_version = api.runtime_version.transaction_version;

    // Example bytes to add
    let bytes_to_add: Vec&lt;u8&gt; = vec![1, 2, 3, 4];
    // Example CID for the example bytes added vec![1, 2, 3, 4]
    let cid = String::from(&quot;QmRgctVSR8hvGRDLv7c5H7BCji7m1VXRfEE1vW78CFagD7&quot;)
        .into_bytes()
        .to_vec();

    // Create input for all calls
    let calls = vec![
        (&quot;ipfs_add_bytes&quot;, bytes_to_add),
        (&quot;ipfs_cat_bytes&quot;, cid.clone()),
    ];

    // Create Extinsics and listen for all calls
    for call in calls {
        println!(&quot;\n Creating Extrinsic for {}&quot;, call.0);
        let _call = compose_call!(meta, &quot;TemplateModule&quot;, call.0, call.1);
        let xt: UncheckedExtrinsicV4&lt;_&gt; = compose_extrinsic_offline!(
            signer,
            _call,
            nonce,
            Era::Immortal,
            genesis_hash,
            genesis_hash,
            spec_version,
            transaction_version
        );

        let blockh = api
            .send_extrinsic(xt.hex_encode(), XtStatus::Finalized)
            .unwrap();
        println!(&quot;Transaction got finalized in block {:?}&quot;, blockh);
        nonce += 1;
    }
}
</code></pre></pre>
<p>For full demo with all pallet functions, please visit <a href="https://github.com/whalelephant/offchain_ipfs_api_clients">here</a></p>
<h1><a class="header" href="#in-javascript" id="in-javascript">In JavaScript</a></h1>
<p>This should work in both node.js and the browser via a bundler like Webpack or Parcel.</p>
<h1><a class="header" href="#with-polkadotjs" id="with-polkadotjs">With polkadot.js</a></h1>
<pre><code class="language-bash">$ yarn init
$ yarn add @polkadot/api
</code></pre>
<pre><code class="language-javascript">// Import
const { ApiPromise, WsProvider, Keyring } = require('@polkadot/api');

;(async () =&gt; {
  const provider = new WsProvider('ws://localhost:9944');
  const api = await ApiPromise.create({
    provider,
    types: {
      ConnectionCommand: 'ConnectionCommand',
      DataCommand: 'DataCommand',
      DhtCommand: 'DhtCommand',
      Address: 'AccountId',
      LookupSource: 'AccountId'
    }
  });

  await api.isReady;

  const keyring = new Keyring({ type: 'sr25519' });
  const alice = keyring.addFromUri('//Alice');
  const module = api.tx.templateModule

  const PEER_ID = 'QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ'
  const PEER_MULTIADDR = `/ip4/104.131.131.82/tcp/4001/p2p/${PEER_ID}`
  const CID_1234 = 'QmU1f6ngsoHvwtViihzLQPXCA8j3sagmvY9GJJDY7Ao7Aa'

  // Connect to a peer
  // await module.ipfsConnect(PEER_MULTIADDR).signAndSend(alice, logEvents)

  // Add data as bytes (string or raw) to IPFS
  // await module.ipfsAddBytes('1234').signAndSend(alice, logEvents)

  // Cat (retrieve) data from IPFS
  // await module.ipfsCatBytes(CID_1234).signAndSend(alice, logEvents)

  // Disconnect from a peer
  // await module.ipfsDisconnect(PEER_MULTIADDR).signAndSend(alice, logEvents)

  // Locate a peer via the distributed hash table
  // await module.ipfsDhtFindPeer(PEER_ID).signAndSend(alice, logEvents)

  // Locate a peer that has the content you're seeing via the DHT
  // await module.ipfsDhtFindPeer(CID_1234).signAndSend(alice, logEvents)
})()

const logEvents = ({ status, events }) =&gt; {
  if (status.isInBlock) {
    console.log(`included in ${status.asInBlock}`);
  }

  if (status.isInBlock || status.isFinalized) {
    events.forEach((record) =&gt; {
      const { event, phase } = record;
      const types = event.typeDef;

      console.log(`\t${event.section}:${event.method}:: (phase=${phase.toString()})`);
      console.log(`\t\t${event.meta.documentation.toString()}`);

      event.data.forEach((data, index) =&gt; {
        console.log(`\t\t\t${types[index].type}: ${data.toString()}`);
      });
    })
  }
}
</code></pre>
<h3><a class="header" href="#debugging-json-rpc-in-the-browser" id="debugging-json-rpc-in-the-browser">Debugging JSON-RPC in the browser</a></h3>
<p>You will connect to the blockchain node via JSON-RPC over WebSockets., On page load it will
connect to port 9944 via WebSockets.</p>
<p>One good way to monitor the streaming results in the browser is to use devtools:</p>
<h1><a class="header" href="#contributing--development" id="contributing--development">Contributing / Development</a></h1>
<p>There are several angles that people can take to contribute to this effort.</p>
<p>TODO: Enumerate them</p>
<h1><a class="header" href="#building-from-source" id="building-from-source">Building from Source</a></h1>
<h2><a class="header" href="#building-the-docker-image-from-source" id="building-the-docker-image-from-source">Building the docker image from source</a></h2>
<pre><code class="language-bash">$ git clone https://github.com/rs-ipfs/substrate
$ cd substrate
$ docker build --file .maintain/Dockerfile --tag substrate-ipfs .
</code></pre>
<p>This is a multistage build with the target being an image with name substrate-ipfs:latest
containing the substrate binary and the node-template binary.</p>
<p>Note that this will take forever</p>
<h2><a class="header" href="#running-the-node-from-source" id="running-the-node-from-source">Running the node from source</a></h2>
<pre><code class="language-bash">$ git clone https://github.com/rs-ipfs/substrate
$ cd substrate
$ git checkout offchain_ipfs
$ cargo build --workspace
</code></pre>
<p>And get a coffeeâ€¦</p>
<p>Note that this will take forever, but less time than building in alpine</p>
<h1><a class="header" href="#architectural-explanation" id="architectural-explanation">Architectural Explanation</a></h1>
<p>TODO: How does it work?</p>
<p>Explain this: https://github.com/rs-ipfs/substrate/commit/ee328957b3fe9d1b0c9219478af013550a900e59</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
